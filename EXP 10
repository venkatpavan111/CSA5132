#include <stdio.h>
#include <string.h>
#include <ctype.h>

char matrix[5][5];
int used[26];

void generateMatrix(char key[]) {
    int i,k=0;
    for(i=0;i<26;i++) used[i]=0;

    for(i=0;key[i];i++){
        if(key[i]=='J') key[i]='I';
        if(!used[key[i]-'A']){
            used[key[i]-'A']=1;
            matrix[k/5][k%5]=key[i];
            k++;
        }
    }
    for(i=0;i<26;i++){
        if(i+'A'=='J') continue;
        if(!used[i]){
            matrix[k/5][k%5]=i+'A';
            k++;
        }
    }
}

void findPos(char c,int *r,int *c2){
    for(int i=0;i<5;i++)
        for(int j=0;j<5;j++)
            if(matrix[i][j]==c){*r=i;*c2=j;}
}

void encrypt(char text[]){
    for(int i=0;i<strlen(text);i+=2){
        int r1,c1,r2,c2;
        findPos(text[i],&r1,&c1);
        findPos(text[i+1],&r2,&c2);

        if(r1==r2){
            text[i]=matrix[r1][(c1+1)%5];
            text[i+1]=matrix[r2][(c2+1)%5];
        }
        else if(c1==c2){
            text[i]=matrix[(r1+1)%5][c1];
            text[i+1]=matrix[(r2+1)%5][c2];
        }
        else{
            text[i]=matrix[r1][c2];
            text[i+1]=matrix[r2][c1];
        }
    }
}

int main(){
    char key[]="CIPHER";
    char text[100];

    generateMatrix(key);
    printf("Enter plaintext (even length): ");
    gets(text);

    encrypt(text);
    printf("Ciphertext: %s",text);
}
